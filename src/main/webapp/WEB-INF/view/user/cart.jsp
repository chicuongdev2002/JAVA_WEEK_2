<%@ page import="vn.edu.iuh.fit.lab_week_2_nguyenchicuong.models.Cart" %><%@ page import="vn.edu.iuh.fit.lab_week_2_nguyenchicuong.models.Product" %><%@ page import="java.text.DecimalFormat" %><%@ page import="vn.edu.iuh.fit.lab_week_2_nguyenchicuong.reposities.ProductPriceRepository" %><%@ page import="vn.edu.iuh.fit.lab_week_2_nguyenchicuong.reposities.ProductRepository" %><%@ page import="vn.edu.iuh.fit.lab_week_2_nguyenchicuong.models.ProductPrice" %><%@ page import="java.util.Map" %><%--  Created by IntelliJ IDEA.  User: Win 11  Date: 11/23/2023  Time: 11:14 AM  To change this template use File | Settings | File Templates.--%><%@ page contentType="text/html;charset=UTF-8" language="java" %><html><head>    <title>Cart</title>    <link rel="stylesheet" href="/WEB-INF/view/admin/css/cart.css"><link>    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"><script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script></head><body><div class="container mt-5 p-3 rounded cart">    <div class="row no-gutters">        <div class="col-md-8">            <div class="product-details mr-2">                <div class="d-flex flex-row align-items-center"><i class="fa fa-long-arrow-left"></i><span class="ml-2">Continue Shopping</span></div>                <hr>                <h6 class="mb-0">Shopping cart</h6>                <%                    ProductRepository productRepository = new ProductRepository(Product.class);                    %>                <div class="d-flex justify-content-between"><span>Bạn có</span>                    <div class="d-flex flex-row align-items-center"><span class="text-black-50">Sort by:</span>                        <div class="price ml-2"><span class="mr-1">price</span><i class="fa fa-angle-down"></i></div>                    </div>                </div>                <%                    Cart listcart = (Cart) request.getAttribute("cart");                    double totalAmount = 0;                    double ship=20000;                    ProductPriceRepository productPriceRepository = new ProductPriceRepository(ProductPrice.class);                    if (listcart != null) {                        for (Product product : listcart.getProducts()) {                            Map<Long, Integer> productQuantities = (Map<Long, Integer>) session.getAttribute("productQuantities");                            int quantity = productQuantities.get(product.getProduct_id()); // Lấy số lượng từ Map                            double price = productPriceRepository.getPriceById(product.getProduct_id());                            // Tính tổng tiền cho sản phẩm                            double productTotal = price * quantity;                            // Cộng tổng tiền của sản phẩm vào tổng tiền của giỏ hàng                            totalAmount += productTotal;                            if(quantity>5){                                ship=0;                            }                %>                <div class="d-flex justify-content-between align-items-center mt-3 p-2 items rounded">                    <div class="d-flex flex-row"><img class="rounded" src="<%=product.getImages().get(0).getPath()%>" width="40">                        <div class="ml-2"><span class="font-weight-bold d-block"><%=product.getName()%></span></div>                    </div>                    <%                        DecimalFormat decimalFormat = new DecimalFormat("###,###,###");                        String formattedPrice = decimalFormat.format(price);                    %>                    <div class="d-flex flex-row align-items-center"><span class="d-block"><%=quantity%></span><span class="d-block ml-5 font-weight-bold"><%=formattedPrice%></span><i class="fa fa-trash-o ml-3 text-black-50"></i></div>                </div>            </div>            <%                    }                } else {                    System.out.println("null");                }            %>        </div>        <div class="col-md-4">            <div class="payment-info">              <span class="type d-block mt-3 mb-1">Loại thẻ</span><label class="radio"> <input type="radio" name="card" value="payment" checked> <span><img width="30" src="https://img.icons8.com/color/48/000000/mastercard.png"/></span> </label>                <label class="radio"> <input type="radio" name="card" value="payment"> <span><img width="30" src="https://img.icons8.com/officel/48/000000/visa.png"/></span> </label>                <label class="radio"> <input type="radio" name="card" value="payment"> <span><img width="30" src="https://img.icons8.com/ultraviolet/48/000000/amex.png"/></span> </label>                <label class="radio"> <input type="radio" name="card" value="payment"> <span><img width="30" src="https://img.icons8.com/officel/48/000000/paypal.png"/></span> </label>                <div><label class="credit-card-label">Tên thẻ</label><input type="text" class="form-control credit-inputs" placeholder="Name"></div>                <div><label class="credit-card-label">Số thẻ</label><input type="text" class="form-control credit-inputs" placeholder="0000 0000 0000 0000"></div>                <div class="row">                    <div class="col-md-6"><label class="credit-card-label">Ngày</label><input type="text" class="form-control credit-inputs" placeholder="12/24"></div>                </div>                <hr class="line">                <div class="d-flex justify-content-between information"><span>Tổng tiền sản phẩm</span><span><%=totalAmount%></span></div>                <div class="d-flex justify-content-between information"><span>Phí Ship</span><span><%=ship%></span></div>                <div class="d-flex justify-content-between information"><span>Thành tiền</span><span><%=totalAmount+ship%></span></div><button class="btn btn-primary btn-block d-flex justify-content-between mt-3" type="button"><span>$3020.00</span><span>Checkout<i class="fa fa-long-arrow-right ml-1"></i></span></button></div>        </div>    </div></div></body></html>