package vn.edu.iuh.fit.lab_week_2_nguyenchicuong.controllers;import jakarta.servlet.ServletException;import jakarta.servlet.annotation.WebServlet;import jakarta.servlet.http.HttpServlet;import jakarta.servlet.http.HttpServletRequest;import jakarta.servlet.http.HttpServletResponse;import jakarta.servlet.http.HttpSession;import vn.edu.iuh.fit.lab_week_2_nguyenchicuong.models.Cart;import vn.edu.iuh.fit.lab_week_2_nguyenchicuong.models.Product;import vn.edu.iuh.fit.lab_week_2_nguyenchicuong.reposities.ProductRepository;import java.io.IOException;import java.util.ArrayList;import java.util.HashMap;import java.util.List;import java.util.Map;@WebServlet(name = "CartSeverlet",value = "/cart-severlet")public class CartSeverlet extends HttpServlet {    private ProductRepository productRepository = new ProductRepository(Product.class);    @Override    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {        String action = req.getParameter("action");        if (action.equalsIgnoreCase("addToCart")) {            HttpSession session = req.getSession(true);            Cart cart = (Cart) session.getAttribute("cart");            if (cart == null) {                cart = new Cart();                cart.setProducts(new ArrayList<>());                session.setAttribute("cart", cart);                req.setAttribute("count", 0);                session.setAttribute("productQuantities", new HashMap<Long,Integer>());            }            String id = req.getParameter("id");            long iD = Long.parseLong(id);            Product product = productRepository.getById(iD);            Map<Long, Integer> productQuantities = (Map<Long, Integer>) session.getAttribute("productQuantities");            // Kiểm tra xem sản phẩm đã có trong giỏ hàng chưa            if (productQuantities.containsKey(iD)) {                int quantity = productQuantities.get(iD);                quantity++;                productQuantities.put(iD, quantity);            } else {                // Nếu sản phẩm chưa có trong giỏ hàng, thêm nó với số lượng là 1                productQuantities.put(iD, 1);                cart.getProducts().add(product);            }            System.out.println(productQuantities);            session.setAttribute("productQuantities", productQuantities);            System.out.println(cart);            int count = cart.getProducts().size();            System.out.println(count);            req.setAttribute("count", count);            req.getRequestDispatcher("index.jsp").forward(req, resp);        } else if (action.equalsIgnoreCase("viewToCart")) {            HttpSession session = req.getSession();            Cart cart = (Cart) session.getAttribute("cart");            req.setAttribute("cart", cart);  // Set the actual Cart object            req.getRequestDispatcher("WEB-INF/view/user/cart.jsp").forward(req, resp);        }    }}